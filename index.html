<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Ù…ØªØ¬Ø± Ù„ÙˆÙÙŠ â€” Ø´Ø­Ù† ÙˆØ¨Ø·Ø§Ù‚Ø§Øª</title>
<style>
  :root{
    --bg:#0b0b0c;
    --card:#141416;
    --accent:#ff0033;
    --neon:#00eaff;
    --muted:#999;
    --glass: rgba(255,255,255,0.03);
  }

  *{box-sizing:border-box}
  body{
    margin:0;
    font-family: "Tajawal", "Cairo", Arial, sans-serif;
    background: linear-gradient(180deg,var(--bg), #070707);
    color:#fff;
    -webkit-font-smoothing:antialiased;
    -moz-osx-font-smoothing:grayscale;
  }

  /* HEADER */
  header{
    position:sticky; top:0; z-index:1000;
    background:linear-gradient(90deg,#071018 0%, #0b0b0c 100%);
    border-bottom:1px solid rgba(255,255,255,0.03);
    padding:10px 18px;
    display:flex; align-items:center; gap:12px; justify-content:space-between;
  }
  .logo {font-weight:800; color:var(--neon); font-size:20px;}
  nav{display:flex; gap:12px; align-items:center;}
  nav a{
    color:#ddd; text-decoration:none; padding:8px 12px; border-radius:8px;
    transition:.15s; font-size:14px;
  }
  nav a:hover{background:var(--glass); color:var(--neon);}

  .header-right{display:flex; gap:8px; align-items:center;}
  .icon-btn{background:transparent; border:1px solid rgba(255,255,255,0.04); color:#fff; padding:8px 10px; border-radius:8px; cursor:pointer}
  .cart-count{background:var(--accent); color:white; font-weight:700; padding:2px 7px; border-radius:100px; margin-left:6px; font-size:13px;}

  /* LAYOUT */
  .wrap{max-width:1100px; margin:22px auto; padding:0 16px;}
  .hero{
    background: linear-gradient(90deg, rgba(0,0,0,0.6), rgba(0,0,0,0.5)), url('https://i.ibb.co/yWzpp4v/gaming-bg.jpg') center/cover no-repeat;
    height:220px; border-radius:12px; display:flex; align-items:center; justify-content:center; text-align:center;
  }
  .hero h1{font-size:28px; margin:0; color:var(--neon); padding:12px 18px; background:rgba(0,0,0,0.5); border-radius:8px;}

  /* CATEGORIES */
  .cats{display:flex; gap:10px; overflow:auto; padding:14px 0; margin-top:14px}
  .cat{background:rgba(255,255,255,0.02); padding:8px 14px; border-radius:999px; color:#ddd; cursor:pointer; white-space:nowrap; border:1px solid rgba(255,255,255,0.02)}
  .cat.active{background:linear-gradient(90deg,var(--neon), #00a8c3); color:#071018; font-weight:700}

  /* GRID */
  .grid{display:grid; grid-template-columns:repeat(auto-fill,minmax(240px,1fr)); gap:16px; margin-top:18px}
  .card{
    background:var(--card); border-radius:12px; padding:12px; transition:transform .15s, box-shadow .15s; border:1px solid rgba(255,255,255,0.02);
    display:flex; flex-direction:column; gap:8px;
  }
  .card:hover{transform:translateY(-6px); box-shadow:0 10px 30px rgba(0,0,0,0.6)}
  .card img{width:100%; height:150px; object-fit:cover; border-radius:8px; background:#000}
  .card .title{font-weight:700; color:#fff; font-size:16px}
  .card .desc{color:var(--muted); font-size:13px; min-height:36px}
  .price-row{display:flex; justify-content:space-between; align-items:center; gap:10px}
  .price{color:#9fff6a; font-weight:800}
  .small{font-size:13px; color:var(--muted)}

  .actions{display:flex; gap:8px}
  .btn{background:var(--neon); color:#071018; border:none; padding:10px 12px; border-radius:8px; cursor:pointer; font-weight:700; text-decoration:none; text-align:center}
  .btn.ghost{background:transparent; color:#fff; border:1px solid rgba(255,255,255,0.06)}
  .btn.warn{background:var(--accent); color:#fff}

  /* SIDEBAR CART */
  .cart-panel{
    position:fixed; right:16px; top:80px; width:320px; max-width:92%; background:linear-gradient(180deg, rgba(15,15,15,0.98), rgba(10,10,10,0.98)); padding:12px; border-radius:10px; border:1px solid rgba(255,255,255,0.03);
    box-shadow:0 10px 30px rgba(0,0,0,0.6); z-index:1200;
  }
  .cart-panel h3{margin:0 0 8px 0; color:var(--neon)}
  .cart-item{display:flex; gap:10px; align-items:center; margin-bottom:10px}
  .cart-item img{width:56px; height:40px; object-fit:cover; border-radius:6px}
  .cart-item .meta{flex:1}
  .cart-item .meta .name{font-weight:700; font-size:14px}
  .cart-item .meta .q{font-size:13px; color:var(--muted)}
  .cart-item .price{font-weight:800; color:#b3ff9a}
  .cart-footer{border-top:1px solid rgba(255,255,255,0.03); padding-top:10px; margin-top:8px; display:flex; flex-direction:column; gap:8px}
  .total-row{display:flex; justify-content:space-between; font-weight:800; font-size:18px}
  .checkout-wrap{display:flex; gap:8px}

  /* LOGIN MODAL */
  .modal{
    position:fixed; inset:0; display:flex; align-items:center; justify-content:center; background:rgba(0,0,0,0.6); z-index:2000;
  }
  .modal .box{width:360px; max-width:95%; background:linear-gradient(180deg,#0f0f12,#0b0b0b); padding:18px; border-radius:10px; border:1px solid rgba(255,255,255,0.04)}
  .modal h2{margin:0 0 10px 0; color:var(--neon)}
  .form-row{display:flex; flex-direction:column; gap:8px; margin-bottom:8px}
  input[type=text], input[type=password], input[type=email]{
    padding:10px; border-radius:8px; border:1px solid rgba(255,255,255,0.04); background:transparent; color:#fff;
  }
  label{font-size:13px; color:var(--muted)}

  /* ACCOUNT PAGE */
  .account{background:var(--card); padding:12px; border-radius:10px}
  .orders-list{display:flex; flex-direction:column; gap:8px}

  /* Responsive */
  @media (max-width:900px){
    header{flex-direction:column; gap:8px; align-items:flex-start}
    .cart-panel{position:fixed; left:50%; transform:translateX(-50%); bottom:12px; top:auto; width:92%}
  }
</style>
</head>
<body>

<header>
  <div style="display:flex;align-items:center;gap:12px">
    <div class="logo">Ù…ØªØ¬Ø± Ù„ÙˆÙÙŠ</div>
    <div style="font-size:13px;color:var(--muted)">Ø¨Ø·Ø§Ù‚Ø§Øª â€¢ Ø´Ø­Ù† Ø£Ù„Ø¹Ø§Ø¨ â€¢ Ø§Ø´ØªØ±Ø§ÙƒØ§Øª</div>
  </div>

  <div class="header-right">
    <nav>
      <a href="#pubg">Ø¨Ø¨Ø¬ÙŠ</a>
      <a href="#freefire">ÙØ±ÙŠ ÙØ§ÙŠØ±</a>
      <a href="#cards">Ø¨Ø·Ø§Ù‚Ø§Øª</a>
      <a href="#subs">Ø§Ø´ØªØ±Ø§ÙƒØ§Øª</a>
      <a href="#contact">ØªÙˆØ§ØµÙ„</a>
    </nav>

    <button class="icon-btn" id="open-cart-btn" title="Ø§Ù„Ø³Ù„Ø©">
      ğŸ§¾ Ø³Ù„Ø© <span id="cart-count" class="cart-count">0</span>
    </button>

    <button class="icon-btn" id="login-btn">Ø¯Ø®ÙˆÙ„ / Ø­Ø³Ø§Ø¨ÙŠ</button>
  </div>
</header>

<main class="wrap">
  <div class="hero">
    <h1>Ø£ÙØ¶Ù„ Ø¹Ø±ÙˆØ¶ Ø§Ù„Ø´Ø­Ù† ÙˆØ§Ù„Ø¨Ø·Ø§Ù‚Ø§Øª â€” ØªÙˆØµÙŠÙ„ ÙÙˆØ±ÙŠ</h1>
  </div>

  <!-- ÙØ¦Ø§Øª -->
  <div class="cats" id="cats">
    <div class="cat active" data-cat="all">Ø§Ù„ÙƒÙ„</div>
    <div class="cat" data-cat="pubg">PUBG</div>
    <div class="cat" data-cat="freefire">Free Fire</div>
    <div class="cat" data-cat="cards">Ø¨Ø·Ø§Ù‚Ø§Øª</div>
    <div class="cat" data-cat="subs">Ø§Ø´ØªØ±Ø§ÙƒØ§Øª</div>
    <div class="cat" data-cat="robux">Robux</div>
  </div>

  <!-- GRID Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª -->
  <section class="grid" id="product-grid"></section>

  <!-- Ù‚Ø³Ù… ØªÙˆØ§ØµÙ„ Ø³Ø±ÙŠØ¹ -->
  <section style="margin-top:30px; background:linear-gradient(180deg, rgba(255,255,255,0.01), transparent); padding:14px; border-radius:10px;">
    <div style="display:flex; justify-content:space-between; gap:12px; align-items:center; flex-wrap:wrap;">
      <div>
        <div style="font-weight:800; color:var(--neon); font-size:16px">ğŸ“ Ù„Ù„ØªÙˆØ§ØµÙ„ Ùˆ Ø§Ù„Ø·Ù„Ø¨</div>
        <div style="color:var(--muted)">ÙˆØ§ØªØ³Ø§Ø¨ / Ø§ØªØµØ§Ù„: +218 91 180 2061</div>
      </div>
      <div>
        <a class="btn" href="https://wa.me/218911802061" target="_blank">Ø±Ø§Ø³Ù„Ù†Ø§ Ø¹Ù„Ù‰ ÙˆØ§ØªØ³Ø§Ø¨</a>
      </div>
    </div>
  </section>

  <!-- ØµÙØ­Ø© Ø­Ø³Ø§Ø¨ÙŠ ØµØºÙŠØ±Ø© (Ù…Ø«Ø§Ù„ ÙÙŠ Ø£Ø³ÙÙ„ Ø§Ù„ØµÙØ­Ø©) -->
  <section id="account-section" style="margin-top:26px;">
    <div class="account" id="account-box" style="display:none">
      <div style="display:flex; justify-content:space-between; align-items:center; gap:10px;">
        <div>
          <div style="font-weight:800; color:var(--neon)">Ø­Ø³Ø§Ø¨ÙŠ</div>
          <div class="small" id="account-email"></div>
        </div>
        <button class="btn ghost" id="logout-btn">ØªØ³Ø¬ÙŠÙ„ Ø®Ø±ÙˆØ¬</button>
      </div>

      <div style="margin-top:12px">
        <div style="font-weight:700; margin-bottom:8px">Ø§Ù„Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ø³Ø§Ø¨Ù‚Ø©</div>
        <div class="orders-list" id="orders-list"></div>
      </div>
    </div>
  </section>

  <!-- Footer / contact -->
  <footer id="contact" style="margin-top:30px; text-align:center; padding:24px; color:var(--muted)">
    Â© 2025 Ù…ØªØ¬Ø± Ù„ÙˆÙÙŠ â€” Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ‚ Ù…Ø­ÙÙˆØ¸Ø© â€” Ù„Ù„ØªÙˆØ§ØµÙ„: +218 91 180 2061
  </footer>
</main>

<!-- CART PANEL -->
<div id="cart-panel" class="cart-panel" style="display:none">
  <h3>Ø³Ù„Ø© Ø§Ù„Ù…Ø´ØªØ±ÙŠØ§Øª</h3>
  <div id="cart-items"></div>
  <div class="cart-footer">
    <div class="total-row"><div>Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ</div><div id="cart-total">0 Ø¯.Ù„</div></div>
    <div class="checkout-wrap">
      <button class="btn" id="checkout-ws">Ø§Ù„Ø¯ÙØ¹ Ø¹Ø¨Ø± ÙˆØ§ØªØ³Ø§Ø¨</button>
      <button class="btn ghost" id="clear-cart">ØªÙØ±ÙŠØº</button>
    </div>
  </div>
</div>

<!-- LOGIN MODAL -->
<div id="login-modal" style="display:none" class="modal" aria-hidden="true">
  <div class="box">
    <h2>ØªØ³Ø¬ÙŠÙ„ Ø¯Ø®ÙˆÙ„ / Ø¥Ù†Ø´Ø§Ø¡ Ø­Ø³Ø§Ø¨</h2>
    <div class="form-row">
      <label>Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ</label>
      <input id="login-email" type="email" placeholder="you@example.com">
    </div>
    <div class="form-row">
      <label>ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±</label>
      <input id="login-pass" type="password" placeholder="********">
    </div>
    <div style="display:flex; gap:8px; justify-content:flex-end; margin-top:8px">
      <button class="btn" id="do-login">Ø¯Ø®ÙˆÙ„</button>
      <button class="btn ghost" id="create-acc">Ø¥Ù†Ø´Ø§Ø¡ Ø­Ø³Ø§Ø¨</button>
      <button class="btn ghost" id="close-login">Ø¥ØºÙ„Ø§Ù‚</button>
    </div>
    <div style="margin-top:10px; color:var(--muted); font-size:13px">
      Ù…Ù„Ø§Ø­Ø¸Ø©: Ù‡Ø°Ø§ ØªØ³Ø¬ÙŠÙ„ Ù…Ø­Ù„ÙŠ Ù„Ù„ØªØ¬Ø±Ø¨Ø©ØŒ Ù„Ù† Ù†Ø®Ø²Ù† Ø´ÙŠØ¡ Ø®Ø§Ø±Ø¬ Ù…ØªØµÙØ­Ùƒ.
    </div>
  </div>
</div>

<script>
/* ============== Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª ============== */
/* Ø§Ù„Ø³Ø¹Ø±Ø§Øª Ù‡Ù†Ø§ ÙƒØ£Ù…Ø«Ù„Ø© â€” Ø¹Ø¯Ù‘Ù„Ù‡Ù… Ø­Ø³Ø¨ Ù…Ø§ ØªØ±ÙŠØ¯Ù‡ */
const PRODUCTS = [
  // PUBG
  {id:'pubg-60', title:'PUBG 60 UC', cat:'pubg', price:3.50, img:'https://i.ibb.co/3r5cm0V/pubg-uc.jpg', desc:'Ø´Ø­Ù† ÙÙˆØ±ÙŠ Ù„Ù€ 60 UC'},
  {id:'pubg-325', title:'PUBG 325 UC', cat:'pubg', price:15.00, img:'https://i.ibb.co/3r5cm0V/pubg-uc.jpg', desc:'Ø´Ø­Ù† ÙÙˆØ±ÙŠ Ù„Ù€ 325 UC'},
  {id:'pubg-660', title:'PUBG 660 UC', cat:'pubg', price:28.00, img:'https://i.ibb.co/3r5cm0V/pubg-uc.jpg', desc:'Ø´Ø­Ù† ÙÙˆØ±ÙŠ Ù„Ù€ 660 UC'},
  {id:'pubg-1800', title:'PUBG 1800 UC', cat:'pubg', price:72.00, img:'https://i.ibb.co/3r5cm0V/pubg-uc.jpg', desc:'Ø´Ø­Ù† ÙÙˆØ±ÙŠ Ù„Ù€ 1800 UC'},

  // Free Fire
  {id:'ff-100', title:'Free Fire 100 Diamonds', cat:'freefire', price:2.50, img:'https://i.ibb.co/1vTQG7F/freefire.jpg', desc:'Ø´Ø­Ù† Ø³Ø±ÙŠØ¹ Ù„Ù„Ø§Ø¹Ø¨ÙŠ Free Fire'},
  {id:'ff-310', title:'Free Fire 310 Diamonds', cat:'freefire', price:6.50, img:'https://i.ibb.co/1vTQG7F/freefire.jpg', desc:'Ø´Ø­Ù† Ø³Ø±ÙŠØ¹ Ù„Ù„Ø§Ø¹Ø¨ÙŠ Free Fire'},

  // Cards
  {id:'gp-10', title:'Google Play $10', cat:'cards', price:8.50, img:'https://i.ibb.co/C8xR5cH.png', desc:'Ø¨Ø·Ø§Ù‚Ø© Google Play Ù‚ÙŠÙ…Ø© 10 Ø¯ÙˆÙ„Ø§Ø±'},
  {id:'it-15', title:'iTunes $15', cat:'cards', price:13.50, img:'https://i.ibb.co/umj9U9R.png', desc:'Ø¨Ø·Ø§Ù‚Ø© iTunes Ù‚ÙŠÙ…Ø© 15 Ø¯ÙˆÙ„Ø§Ø±'},
  {id:'psn-20', title:'PlayStation $20', cat:'cards', price:18.00, img:'https://i.ibb.co/L8UQwPN.png', desc:'ÙƒÙˆØ¯ PSN Ù‚ÙŠÙ…Ø© 20 Ø¯ÙˆÙ„Ø§Ø±'},
  {id:'xbox-25', title:'Xbox $25', cat:'cards', price:22.00, img:'https://i.ibb.co/cgl3YMJ.png', desc:'Ø¨Ø·Ø§Ù‚Ø© Xbox 25 Ø¯ÙˆÙ„Ø§Ø±'},
  {id:'steam-20', title:'Steam $20', cat:'cards', price:18.50, img:'https://i.ibb.co/TS7ImYJ.png', desc:'Steam Wallet 20$'},

  // Subscriptions
  {id:'net-1m', title:'Netflix 1 Ø´Ù‡Ø±', cat:'subs', price:6.00, img:'https://i.ibb.co/umj9U9R.png', desc:'Ø§Ø´ØªØ±Ø§Ùƒ Netflix Ù„Ø´Ù‡Ø± ÙˆØ§Ø­Ø¯'},
  {id:'spot-1m', title:'Spotify 1 Ø´Ù‡Ø±', cat:'subs', price:2.50, img:'https://i.ibb.co/7Qz8hxq.png', desc:'Ø§Ø´ØªØ±Ø§Ùƒ Spotify Ù„Ø´Ù‡Ø± ÙˆØ§Ø­Ø¯'},
  {id:'yt-1m', title:'YouTube Premium 1 Ø´Ù‡Ø±', cat:'subs', price:3.25, img:'https://i.ibb.co/7nG1V3v.png', desc:'Ø§Ø´ØªØ±Ø§Ùƒ YT Premium Ø´Ù‡Ø±'},

  // Robux
  {id:'rob-400', title:'Robux 400', cat:'robux', price:4.00, img:'https://i.ibb.co/ZywjgGm.png', desc:'Ø´Ø­Ù† Robux Ù„Ø­Ø³Ø§Ø¨Ùƒ'},

  // Extras
  {id:'bundle-all', title:'Ø­Ø²Ù…Ø© ÙƒØ§Ù…Ù„Ø© (Ø£Ø´Ù‡Ø± Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª)', cat:'all', price:99.00, img:'https://i.ibb.co/QP0pWpR/notfound.png', desc:'Ø­Ø²Ù…Ø© Ù…Ù…ÙŠØ²Ø© Ù„Ø´Ø­Ù† Ùˆ Ø¨Ø·Ø§Ù‚Ø§Øª'}
];

/* ======== Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„ÙˆØ§Ø¬Ù‡Ø© Ùˆ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª ======== */
const productGrid = document.getElementById('product-grid');
const cats = document.getElementById('cats');
const cartCountEl = document.getElementById('cart-count');
const cartPanel = document.getElementById('cart-panel');
const cartItemsEl = document.getElementById('cart-items');
const cartTotalEl = document.getElementById('cart-total');
const openCartBtn = document.getElementById('open-cart-btn');
const clearCartBtn = document.getElementById('clear-cart');
const checkoutWsBtn = document.getElementById('checkout-ws');

let CART = JSON.parse(localStorage.getItem('luffy_cart')||'[]');
let USER = JSON.parse(localStorage.getItem('luffy_user')||'null');

/* render products by category */
function renderProducts(filter='all'){
  productGrid.innerHTML='';
  const list = PRODUCTS.filter(p => filter==='all' ? true : p.cat === filter);
  list.forEach(p=>{
    const el = document.createElement('article');
    el.className='card';
    el.innerHTML = `
      <img src="${p.img}" alt="${escapeHtml(p.title)}">
      <div class="title">${escapeHtml(p.title)}</div>
      <div class="desc">${escapeHtml(p.desc)}</div>
      <div class="price-row">
        <div class="price">${formatPrice(p.price)}</div>
        <div class="actions">
          <button class="btn ghost" onclick="viewProduct('${p.id}')">ØªÙØ§ØµÙŠÙ„</button>
          <button class="btn" onclick="addToCart('${p.id}')">Ø£Ø¶Ù Ù„Ù„Ø³Ù„Ø©</button>
        </div>
      </div>
    `;
    productGrid.appendChild(el);
  });
}

/* filter cats */
document.querySelectorAll('.cat').forEach(el=>{
  el.addEventListener('click', ()=>{
    document.querySelectorAll('.cat').forEach(c=>c.classList.remove('active'));
    el.classList.add('active');
    renderProducts(el.dataset.cat === 'all' ? 'all' : el.dataset.cat);
  });
});

/* format price */
function formatPrice(n){ return n.toFixed(2) + ' Ø¯.Ù„'; }

/* escape html */
function escapeHtml(s){ return s.replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;'); }

/* CART functions */
function saveCart(){ localStorage.setItem('luffy_cart', JSON.stringify(CART)); updateCartUI(); }
function updateCartUI(){
  cartCountEl.textContent = CART.reduce((s,i)=>s+i.qty,0);
  cartItemsEl.innerHTML='';
  if(CART.length===0){ cartItemsEl.innerHTML = '<div class="small" style="color:var(--muted)">Ø³Ù„Ø© ÙØ§Ø±ØºØ©</div>'; cartTotalEl.textContent='0 Ø¯.Ù„'; return; }
  let total=0;
  CART.forEach(item=>{
    const prod = PRODUCTS.find(p=>p.id===item.id);
    if(!prod) return;
    const row = document.createElement('div');
    row.className='cart-item';
    row.innerHTML = `
      <img src="${prod.img}">
      <div class="meta">
        <div class="name">${escapeHtml(prod.title)}</div>
        <div class="q small">Ø§Ù„ÙƒÙ…ÙŠØ©: <strong>${item.qty}</strong></div>
      </div>
      <div style="text-align:left">
        <div class="price">${formatPrice(prod.price * item.qty)}</div>
        <div style="display:flex; gap:6px; margin-top:6px; justify-content:flex-end">
          <button class="btn ghost" onclick="changeQty('${item.id}', -1)">-</button>
          <button class="btn ghost" onclick="changeQty('${item.id}', 1)">+</button>
          <button class="btn ghost" onclick="removeFromCart('${item.id}')">Ø­Ø°Ù</button>
        </div>
      </div>
    `;
    cartItemsEl.appendChild(row);
    total += prod.price * item.qty;
  });
  cartTotalEl.textContent = total.toFixed(2) + ' Ø¯.Ù„';
}

/* add to cart */
function addToCart(id){
  const existing = CART.find(i=>i.id===id);
  if(existing) existing.qty++;
  else CART.push({id, qty:1});
  saveCart();
  showToast('Ø£Ø¶ÙŠÙ Ø¥Ù„Ù‰ Ø§Ù„Ø³Ù„Ø©');
}

/* change qty */
function changeQty(id, delta){
  const it = CART.find(i=>i.id===id);
  if(!it) return;
  it.qty += delta;
  if(it.qty <= 0) CART = CART.filter(i=>i.id!==id);
  saveCart();
}

/* remove */
function removeFromCart(id){
  CART = CART.filter(i=>i.id!==id);
  saveCart();
}

/* clear */
clearCartBtn.addEventListener('click', ()=>{
  if(!confirm('Ù‡Ù„ ØªØ±ÙŠØ¯ ØªÙØ±ÙŠØº Ø§Ù„Ø³Ù„Ø©ØŸ')) return;
  CART = []; saveCart();
});

/* open/close cart */
openCartBtn.addEventListener('click', ()=>{ cartPanel.style.display = cartPanel.style.display === 'none' ? 'block' : 'none'; updateCartUI(); });

/* Checkout via WhatsApp */
checkoutWsBtn.addEventListener('click', ()=>{
  if(CART.length === 0){ alert('Ø§Ù„Ø³Ù„Ø© ÙØ§Ø±ØºØ©'); return; }
  // compose message
  let msg = 'Ø·Ù„Ø¨ Ù…Ù† Ù…ØªØ¬Ø± Ù„ÙˆÙÙŠ %0A';
  let total = 0;
  CART.forEach(it=>{
    const p = PRODUCTS.find(x=>x.id===it.id);
    msg += `- ${encodeURIComponent(p.title)} x${it.qty} = ${ (p.price*it.qty).toFixed(2) } Ø¯.Ù„%0A`;
    total += p.price*it.qty;
  });
  msg += `%0AØ§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ: ${total.toFixed(2)} Ø¯.Ù„%0A%0AØ§Ù„Ø§Ø³Ù…: %0AØ§Ù„Ø±Ù‚Ù…: %0AÙ…Ù„Ø§Ø­Ø¸Ø©: `;
  // open whatsapp
  const phone = '218911802061';
  const url = `https://wa.me/${phone}?text=${msg}`;
  window.open(url, '_blank');
});

/* small toast */
function showToast(text){
  const t = document.createElement('div'); t.textContent = text;
  t.style.cssText = 'position:fixed; left:50%; transform:translateX(-50%); bottom:20px; background:#121212; color:#fff; padding:10px 14px; border-radius:8px; z-index:9999; box-shadow:0 6px 18px rgba(0,0,0,0.6)';
  document.body.appendChild(t);
  setTimeout(()=>{ t.style.opacity='0'; t.remove(); }, 1400);
}

/* PRODUCT DETAILS (simple modal page) */
function viewProduct(id){
  const p = PRODUCTS.find(x=>x.id===id);
  if(!p) return;
  // simple prompt-based details view (for single-file simplicity)
  const details = `${p.title}\n\n${p.desc}\n\nØ§Ù„Ø³Ø¹Ø±: ${p.price.toFixed(2)} Ø¯.Ù„\n\nÙ‡Ù„ ØªØ±ÙŠØ¯ Ø¥Ø¶Ø§ÙØªÙ‡ Ù„Ù„Ø³Ù„Ø©ØŸ`;
  if(confirm(details)){
    addToCart(id);
  }
}

/* ============ LOGIN & ACCOUNT ============ */
const loginBtn = document.getElementById('login-btn');
const loginModal = document.getElementById('login-modal');
const closeLogin = document.getElementById('close-login');
const doLoginBtn = document.getElementById('do-login');
const createAccBtn = document.getElementById('create-acc');
const logoutBtn = document.getElementById('logout-btn');
const accountBox = document.getElementById('account-box');
const accountEmail = document.getElementById('account-email');
const ordersList = document.getElementById('orders-list');

loginBtn.addEventListener('click', ()=>{
  loginModal.style.display = 'flex';
});
closeLogin.addEventListener('click', ()=> loginModal.style.display='none');

doLoginBtn.addEventListener('click', ()=>{
  const email = document.getElementById('login-email').value.trim();
  const pass = document.getElementById('login-pass').value.trim();
  if(!email || !pass){ alert('Ø§Ø¯Ø®Ù„ Ø§Ù„Ø¨Ø±ÙŠØ¯ ÙˆÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±'); return; }
  // simple local "auth"
  const user = {email};
  USER = user;
  localStorage.setItem('luffy_user', JSON.stringify(USER));
  loginModal.style.display='none';
  updateAccountUI();
  showToast('ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„');
});

createAccBtn.addEventListener('click', ()=>{
  const email = document.getElementById('login-email').value.trim();
  const pass = document.getElementById('login-pass').value.trim();
  if(!email || !pass){ alert('Ø§Ø¯Ø®Ù„ Ø§Ù„Ø¨Ø±ÙŠØ¯ ÙˆÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±'); return; }
  // create account (local)
  const user = {email, orders:[]};
  USER = user;
  localStorage.setItem('luffy_user', JSON.stringify(USER));
  loginModal.style.display='none';
  updateAccountUI();
  showToast('ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø­Ø³Ø§Ø¨');
});

logoutBtn && logoutBtn.addEventListener('click', ()=>{
  if(confirm('Ù‡Ù„ ØªØ±ÙŠØ¯ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬ØŸ')){
    USER = null; localStorage.removeItem('luffy_user');
    updateAccountUI();
  }
});

function updateAccountUI(){
  if(USER){
    accountBox.style.display='block';
    accountEmail.textContent = USER.email || '';
    // load orders
    const orders = JSON.parse(localStorage.getItem('luffy_orders_'+(USER.email||'guest')) || '[]');
    ordersList.innerHTML = '';
    if(orders.length===0) ordersList.innerHTML = '<div class="small" style="color:var(--muted)">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø·Ù„Ø¨Ø§Øª Ø¨Ø¹Ø¯</div>';
    orders.forEach(o=>{
      const d = document.createElement('div');
      d.style.background='rgba(255,255,255,0.02)';
      d.style.padding='8px'; d.style.borderRadius='8px';
      d.innerHTML = `<div style="font-weight:700">${escapeHtml(o.id)}</div><div class="small">Ø§Ù„Ù…Ø­ØªÙˆÙ‰: ${escapeHtml(o.items)}</div><div style="margin-top:6px;color:var(--muted)">Ø§Ù„Ù…Ø¨Ù„Øº: ${o.total} Ø¯.Ù„</div>`;
      ordersList.appendChild(d);
    });
  } else {
    accountBox.style.display='none';
  }
}

/* place order locally (when checkout via whatsapp, we'll also save order) */
function placeOrderAndSave(contactName, contactPhone){
  if(!USER){ alert('Ø³Ø¬Ù‘Ù„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ù„Ø­ÙØ¸ Ø§Ù„Ø·Ù„Ø¨ ÙÙŠ Ø­Ø³Ø§Ø¨Ùƒ'); return; }
  if(CART.length===0){ alert('Ø§Ù„Ø³Ù„Ø© ÙØ§Ø±ØºØ©'); return; }
  const itemsDesc = CART.map(i=>{
    const p = PRODUCTS.find(x=>x.id===i.id);
    return `${p.title} x${i.qty}`;
  }).join(' ØŒ ');
  const total = CART.reduce((s,i)=>s + (PRODUCTS.find(p=>p.id===i.id).price * i.qty), 0).toFixed(2);
  const order = {id:'ORD-'+Date.now(), items: itemsDesc, total};
  // save to localstorage under user email
  const key = 'luffy_orders_' + (USER.email||'guest');
  const arr = JSON.parse(localStorage.getItem(key) || '[]');
  arr.unshift(order);
  localStorage.setItem(key, JSON.stringify(arr));
  // clear cart
  CART = []; saveCart();
  updateAccountUI();
  showToast('ØªÙ… Ø­ÙØ¸ Ø§Ù„Ø·Ù„Ø¨ ÙÙŠ Ø­Ø³Ø§Ø¨Ùƒ');
  return order;
}

/* override checkout to also save order if logged in */
checkoutWsBtn.addEventListener('click', async ()=>{
  if(CART.length === 0){ alert('Ø§Ù„Ø³Ù„Ø© ÙØ§Ø±ØºØ©'); return; }
  let proceed = true;
  if(USER){
    // save order locally
    const order = placeOrderAndSave();
    // then open whatsapp
    // create message from saved order
    let msg = `Ø·Ù„Ø¨ Ù…Ù† Ù…ØªØ¬Ø± Ù„ÙˆÙÙŠ%0AØ±Ù‚Ù… Ø§Ù„Ø·Ù„Ø¨: ${encodeURIComponent(order.id)}%0A`;
    CART.length=0; // already cleared on save
    // we create message based on saved order content:
    msg += `Ø§Ù„Ù…Ø­ØªÙˆÙŠØ§Øª: ${encodeURIComponent(order.items)}%0A`;
    msg += `Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ: ${order.total} Ø¯.Ù„%0A`;
    msg += `%0AØ§Ù„Ø§Ø³Ù…: %0AØ§Ù„Ø±Ù‚Ù…: %0AÙ…Ù„Ø§Ø­Ø¸Ø©: `;
    const url = `https://wa.me/218911802061?text=${msg}`;
    window.open(url, '_blank');
    return;
  } else {
    // not logged: ask user to confirm and open whatsapp with message, but not saved
    if(!confirm('Ø£Ù†Øª ØºÙŠØ± Ù…Ø³Ø¬Ù‘Ù„. Ù‡Ù„ ØªØ±ØºØ¨ Ø¨ÙØªØ­ ÙˆØ§ØªØ³Ø§Ø¨ Ù„Ù„Ø¯ÙØ¹ ÙˆØ­ÙØ¸ Ø§Ù„Ø·Ù„Ø¨ Ù…Ø­Ù„ÙŠØ§Ù‹ØŸ')) return;
    // build message
    let msg = 'Ø·Ù„Ø¨ Ù…Ù† Ù…ØªØ¬Ø± Ù„ÙˆÙÙŠ %0A';
    let total = 0;
    CART.forEach(it=>{
      const p = PRODUCTS.find(x=>x.id===it.id);
      msg += `- ${encodeURIComponent(p.title)} x${it.qty} = ${ (p.price*it.qty).toFixed(2) } Ø¯.Ù„%0A`;
      total += p.price*it.qty;
    });
    msg += `%0AØ§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ: ${total.toFixed(2)} Ø¯.Ù„%0A%0AØ§Ù„Ø§Ø³Ù…: %0AØ§Ù„Ø±Ù‚Ù…: %0AÙ…Ù„Ø§Ø­Ø¸Ø©: `;
    const url = `https://wa.me/218911802061?text=${msg}`;
    // we DO NOT save order if not logged
    window.open(url, '_blank');
  }
});

/* initialize */
function init(){
  renderProducts('all');
  updateCartUI();
  if(USER) updateAccountUI();
  // make cats clickable already done
}
init();

/* small helper: add keyboard ESC to close modals */
document.addEventListener('keydown', (e)=>{ if(e.key==='Escape'){ loginModal.style.display='none'; cartPanel.style.display='none'; } });

/* expose some functions to global scope for inline onclick */
window.addToCart = addToCart;
window.viewProduct = viewProduct;
window.changeQty = changeQty;
window.removeFromCart = removeFromCart;
window.formatPrice = formatPrice;
</script>
</body>
</html>
